"0","train = ames_train %>% "
"0","  mutate(datset = ""train"")"
"0","test = ames_test %>%"
"0","  mutate(datset = ""test"")"
"0","valid = ames_validation %>%"
"0","  mutate(datset = ""valid"")"
"0","dat = train %>% "
"0","  rbind(., test) %>%"
"0","  rbind(., valid)"
"0","findNA = function(col){"
"0","  numNA = sum(is.na(col) | col == """")"
"0","  type = class(col)"
"0","  level = paste(as.character(levels(col)), collapse = "";"")"
"0","  large_0 = sum(table(col) > 0)"
"0","  return(c(numNA, type, level, large_0))"
"0","}"
"0","train_info = lapply(dat, findNA)"
"0","train_info = as.data.frame(do.call(rbind, train_info), stringsAsFactors = F)"
"0","colnames(train_info) = c(""numNA"", ""class"", ""level"")"
"0","train_info$numNA = as.numeric(train_info$numNA)"
"0","train_info$missing_ratio = train_info$numNA/nrow(ames_train)"
"0","train_info$names = rownames(train_info)"
"0","dat1 = dat"
"0","# Bsmt.Exposure"
"0","dat1$Bsmt.Exposure[dat1$Bsmt.Exposure == """" &"
"0","                     !is.na(dat1$Bsmt.Exposure)] = names(sort(table(dat1$Bsmt.Exposure), "
"0","                                                              decreasing = T))[1]"
"0","dat1$Mas.Vnr.Type[dat1$Mas.Vnr.Type == """"] = ""None"""
"0","dat1$Electrical[dat1$Electrical == """"] = names(sort(table(dat1$Electrical),"
"0","                                                    decreasing = T))[1]"
"0","dat1$BsmtFin.Type.2[dat1$BsmtFin.Type.2 == """" &"
"0","                      !is.na(dat1$BsmtFin.Type.2)] = NA"
"0","dat2 = dat1 %>%"
"0","  dplyr::select(-Garage.Yr.Blt) %>%"
"0","  filter(PID != 903426160) %>%"
"0","  mutate(MS.SubClass = as.factor(MS.SubClass),"
"0","         Lot.Frontage = ifelse(is.na(Lot.Frontage), 0, Lot.Frontage),"
"0","         Alley = fct_explicit_na(Alley, ""Unknown""),"
"0","         Pool.QC = fct_explicit_na(Pool.QC, ""Unknown""),"
"0","         Pool.QC = as.numeric(factor(Pool.QC,"
"0","                                     levels = c(""Unknown"", ""Fa"", "
"0","                                                    ""TA"", ""Gd"", ""Ex""))),"
"0","         Fence = fct_explicit_na(Fence, ""Unknown""),"
"0","         Fence = as.numeric(factor(Fence,"
"0","                                     levels = c(""Unknown"", ""MnWw"", ""GdWo"", "
"0","                                                    ""MnPrv"", ""GdPrv""))),"
"0","         Misc.Feature = fct_explicit_na(Misc.Feature, ""Unknown""),"
"0","         Fireplace.Qu = fct_explicit_na(Fireplace.Qu, ""Unknown""),"
"0","         Fireplace.Qu = as.numeric(factor(Fireplace.Qu,"
"0","                                          levels = c(""Unknown"", ""Po"", ""Fa"","
"0","                                                     ""TA"", ""Gd"", ""Ex""))),"
"0","         Garage.Cond = fct_explicit_na(Garage.Cond, ""Unknown""),"
"0","         Garage.Cond = as.numeric(factor(Garage.Cond, "
"0","                                         levels = c(""Unknown"", ""Po"", ""Fa"", "
"0","                                                    ""TA"", ""Gd"", ""Ex""))),"
"0","         Garage.Qual = fct_explicit_na(Garage.Qual, ""Unknown""),"
"0","         Garage.Qual = as.numeric(factor(Garage.Qual, "
"0","                                         levels = c(""Unknown"", ""Po"", ""Fa"", "
"0","                                                    ""TA"", ""Gd"", ""Ex""))),"
"0","         Garage.Type = fct_explicit_na(Garage.Type, ""Unknown""),"
"0","         Garage.Finish = fct_explicit_na(Garage.Finish, ""Unknown""),"
"0","         Garage.Finish = as.numeric(factor(Garage.Finish, "
"0","                                           levels = c(""Unknown"", ""Unf"", "
"0","                                                      ""RFn"", ""Fin""))),"
"0","         Bsmt.Qual = fct_explicit_na(Bsmt.Qual, ""Unknown""),"
"0","         Bsmt.Qual = as.numeric(factor(Bsmt.Qual, "
"0","                                       levels = c(""Unknown"", ""Po"", ""Fa"", "
"0","                                                  ""TA"", ""Gd"", ""Ex""))),"
"0","         Bsmt.Cond = fct_explicit_na(Bsmt.Cond, ""Unknown""),"
"0","         Bsmt.Cond = as.numeric(factor(Bsmt.Cond, "
"0","                                       levels = c(""Unknown"", ""Po"", ""Fa"", "
"0","                                                  ""TA"", ""Gd"", ""Ex""))),"
"0","         Bsmt.Exposure = fct_explicit_na(Bsmt.Exposure, ""Unknown""),"
"0","         Bsmt.Exposure = as.numeric(factor(Bsmt.Exposure, "
"0","                                           levels = c(""Unknown"", ""No"", ""Mn"", "
"0","                                                      ""Av"", ""Gd""))),"
"0","         BsmtFin.Type.1 = fct_explicit_na(BsmtFin.Type.1, ""Unknown""),"
"0","         BsmtFin.Type.1 = as.numeric(factor(BsmtFin.Type.1, "
"0","                                            levels = c(""Unknown"", ""Unf"",""LwQ"","
"0","                                                       ""Rec"", ""BLQ"", "
"0","                                                       ""ALQ"", ""GLQ""))),"
"0","         BsmtFin.Type.2 = fct_explicit_na(BsmtFin.Type.2, ""Unknown""),"
"0","         BsmtFin.Type.2 = as.numeric(factor(BsmtFin.Type.2, "
"0","                                            levels = c(""Unknown"", ""Unf"",""LwQ"","
"0","                                                       ""Rec"", ""BLQ"", "
"0","                                                       ""ALQ"", ""GLQ""))),"
"0","         Mas.Vnr.Area = ifelse(is.na(Mas.Vnr.Area), 0, Mas.Vnr.Area),"
"0","         Utilities = as.numeric(factor(Utilities, "
"0","                                       levels = c(""ELO"",""NoSeWa"",""NoSewr"",""AllPub""))),"
"0","         Lot.Shape = as.numeric(factor(Lot.Shape, "
"0","                                       levels = c(""IR3"",""IR2"",""IR1"",""Reg""))),"
"0","         Exter.Qual= as.numeric(factor(Exter.Qual, "
"0","                                       levels = c(""Po"", ""Fa"", "
"0","                                                  ""TA"", ""Gd"", ""Ex""))),"
"0","         Land.Slope =  as.numeric(factor(Land.Slope, "
"0","                                         levels = c(""Sev"", ""Mod"",""Gtl""))),"
"0","         Exter.Cond = as.numeric(factor(Exter.Cond, "
"0","                                        levels = c(""Po"", ""Fa"", "
"0","                                                   ""TA"", ""Gd"", ""Ex""))),"
"0","         Heating.QC = as.numeric(factor(Heating.QC, "
"0","                                        levels = c(""Po"", ""Fa"", "
"0","                                                   ""TA"", ""Gd"", ""Ex""))),"
"0","         Electrical = as.numeric(factor(Electrical, "
"0","                                        levels = c(""Mix"", ""FuseP"", "
"0","                                                   ""FuseF"", ""FuseA"", ""SBrkr""))),"
"0","         Kitchen.Qual = as.numeric(factor(Kitchen.Qual, "
"0","                                          levels = c(""Po"", ""Fa"", "
"0","                                                     ""TA"", ""Gd"", ""Ex""))),"
"0","         Functional = as.numeric(factor(Functional, "
"0","                                        levels = c(""Sal"", ""Sev"", "
"0","                                                   ""Maj2"", ""Maj1"", ""Mod"","
"0","                                                   ""Min2"",""Min1"",""Typ""))),"
"0","         Paved.Drive = as.numeric(factor(Paved.Drive, "
"0","                                         levels = c(""N"", ""P"",""Y""))),"
"0","         Bsmt.Half.Bath = ifelse(is.na(Bsmt.Half.Bath), 0, Lot.Frontage),"
"0","         Bsmt.Full.Bath = ifelse(is.na(Bsmt.Full.Bath), 0, Lot.Frontage)"
"0","  )"
"0","dat3 = dat2 %>%"
"0","  dplyr::select(-Condition.2)  # different levels in training and testing data"
"0","train_clean = dat3[dat3$datset == ""train"",] %>%"
"0","  dplyr::select(-datset)"
"0","test_clean = dat3[dat3$datset == ""test"",] %>%"
"0","  dplyr::select(-datset)"
"0","validation_clean = dat3[dat3$datset == ""valid"",] %>%"
"0","  dplyr::select(-datset)"
